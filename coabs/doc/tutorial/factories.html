<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Liaison Capability Tutorial</title>
</head>

<body>

<table border="0" width="100%">
  <tr>
    <td width="33%"><font size="2"><b>Liaison Capability Tutorial</b></font></td>
    <td width="33%">
      <p align="center"><a href="administration.html"><img border="0" src="graphics/prev.gif" width="25" height="31"></a>
      <a href="index.html"><img border="0" src="graphics/home.gif" width="45" height="31"></a>
      <a href="operation.html">
      <img border="0" src="graphics/next.gif" width="21" height="31"></a></td>
    <td width="34%">
      <p align="right"><b><font size="2"><a href="../javadoc/index.html">Javadoc</a></font></b></td>
  </tr>
</table>
<hr color="#800080">
<h2 align="left"><b>Interaction Factories</b></h2>
<blockquote>
  <p class="MsoNormal">Some PlugIns may wish to provide services to external
  agents, but they may not wish to construct and start active interaction
  threads that simply wait to be contacted by an external agent, especially if more
  than one external agent might request services concurrently.&nbsp; Instead,
  they can employ an <code>InteractionFactory</code>, which is essentially an on-demand generator of
  <code> Interaction</code> objects. These factories are primarily intended for use by a
  <code> LiaisonDeputy</code> that needs to be able to spawn new interactions in response to
  requests made by external agents; however, they could potentially be used for initiating interactions
  by ALP/Cougaar agents as well.</p>
  <p class="MsoNormal">InteractionFactory is an abstract class, with two methods
  that must be defined in any extending subclass:</p>
  <blockquote>
    <pre>public abstract class InteractionFactory {
  
  public InteractionFactory (LiaisonDeputy deputy, Interactor ia, 
                             String name, boolean shared) {
    ...
  }
  
  public abstract ExternalAgentReference sourceAgent (Object obj);
  
  public abstract boolean handle (Object obj);
  
  ...

}</pre>
  </blockquote>
  <p class="MsoNormal">The <code>sourceAgent</code> method must be able to take
  an object (usually, some kind of message or other information received from an
  external agent), identify the external agent from the contents of the object,
  and return an <code>ExternalAgentReference</code> that can identify the agent
  to a deputy.&nbsp; The <code>handle</code> method is somewhat analogous to the
  equivalently-named method of a <code>MultithreadInteractor</code>:&nbsp; it is
  given an object acquired from some external agent, and it must return <code>true</code>
  if it can create an <code>Interaction</code> with that external agent based
  upon the received object.&nbsp; For example:</p>
  <blockquote>
    <pre>import com.globalinfotek.coabsgrid.*;
import com.prc.alp.liaison.admin.*;
import com.prc.alp.liaison.interact.*;
import com.prc.alp.liaison.plugin.*;

public class TrafficAssessmentInteractionFactory
  extends InteractionFactory {
  
  public TrafficAssessmentInteractionFactory(LiaisonDeputy deputy,
                                             Interactor ia,
                                             String name,
                                             boolean shared)  {
    super (deputy, ia, name, shared);
  }
  
  public ExternalAgentReference sourceAgent (Object obj) {
    // All InteractionFactories maintain a LiaisonDeputy member.
    //   CoABSLiaisonDeputy implementations know how to take a given
    //   incoming CoABS message object and extract the originating
    //   external agent via the getSender method.
    return ((CoABSLiaisonDeputy) deputy).getSender((Message) obj);
  }  
  
  public boolean handle (Object obj) {
    // Perform some test to determine if the incoming object is even
    //   interpretable or understandable
    if ( !meaningfulObject(obj) )
      return false;
    // Figure out what kind of interaction is being requested.  If it's
    //   something we can handle in principle and the source agent is 
    //   acceptable, then return true.
    RequestType rType = extractRequestType(obj);
    if ( acceptableSource(sourceAgent(obj)) &amp;&amp;
         acceptableType(rType) )
      return true;
    else
      return false; 
  }

}</pre>
  </blockquote>
  <p class="MsoNormal">The constructor for any class extending <code>InteractionFactory</code>
 must pass on certain information to the <code>InteractionFactory</code>
  constructor as shown:&nbsp; a <code>LiaisonDeputy</code>, an <code>Interactor</code>
  that will provide the controlling behavior for each <code>Interaction</code>
  generated by this factory, a name for the factory, and a mode indicator.&nbsp;
  Each <code> InteractionFactory</code> can operate in either a shared or non-shared mode, which
  affects how it works with the <code> Interactor</code> its constructor is
  given:</p>
  <ul>
    <li>
      <p class="MsoNormal">If a factory is working in shared mode, then the single given <code> Interactor</code> instance is shared by
  every <code>Interaction</code>&nbsp; created by that factory; such interactors should not maintain any internal
      state.</li>
    <li>
      <p class="MsoNormal">If the factory is working in
  non-shared mode, then the single given <code> Interactor</code> instance is cloned on demand for each new
  <code>Interaction</code>; such interactors must extend <code>CloneableInteractor</code>
  interface and provide a public <code>clone</code> method.</li>
  </ul>
  <p class="MsoNormal">Once an <code>InteractionFactory</code> is constructed,
  it must be registered with a deputy in order to take part in the processing of
  externally-initiated interactions.&nbsp; The necessary code is in <font color="#FF0000">red</font>:</p>
  <blockquote>
    <pre>import com.prc.alp.liaison.plugin.*;
import com.prc.alp.liaison.interact.*;
import com.prc.alp.liaison.LConstants;
import org.cougaar.core.cluster.*;

public class FactoryUsingPlugIn extends SimpleLiaisonPlugIn {

  private LiaisonManager mgr = null;
  private CoABSLiaisonDeputy dep = null;
  
  ... &lt;PlugIn subscriptions, etc.&gt; ...

  protected void setupSubscriptions () {
    ...
    mgr = createLiaisonManager(&quot;Zone27&quot;, &quot;Monitor&quot;, &quot;TrafficControl&quot;);
    mgr.start(true);
    CoABSLiaisonDeputy dep = 
      (CoABSLiaisonDeputy) mgr.createLiaisonDeputy(LConstants.COABS_SOCIETY,
                                                   getDelegate(),
                                                   getParameters());
    dep.start(true);
    <font color="#FF0000">TrafficAssessmentResponder iActor =
        new TrafficAssessmentResponder(dep);
    TrafficAssessmentInteractionFactory fct =
        new TrafficAssessmentInteractionFactory(dep, iActor, 
                                                &quot;TrafficAssessment&quot;, 
                                                false);
    dep.putFactory(&quot;TrafficAssessment&quot;, fct);
    ...</font>
  }</pre>
    <pre>  protected void execute () {
    ...
  }
}</pre>
  </blockquote>
  <p align="left">After constructing and initializing a <code>LiaisonManager</code>
  and <code>LiaisonDeputy</code>, the PlugIn creates an appropriate <code>Interactor</code>
  (the <code>TrafficAssessmentResponder</code>) and passes it to the constructor
  for a specialized factory (the <code>TrafficAssessmentInteractionFactory</code>).&nbsp;
  Then the factory is registered with the deputy by calling <code>LiaisonDeputy.putFactory</code>,
  which saves it in a hash table.&nbsp; The factory is then available for later
  use by the deputy (unless it is later removed by a call to <code>LiaisonDeputy.removeFactory</code>).</p>
  <p align="left">As we have seen earlier, when incoming information (a message) is received by a <code>CoABSLiaisonDeputy</code>,
  it first checks existing active interactions to see if one of them can
  successfully handle the received information.&nbsp; If there are no active
  interactions, or no active interaction handles the information, then the
  deputy assumes that the message is an attempt by an external agent to start a
  new interaction, and it checks its table of registered factories.</p>
  <p align="left">The first factory whose <code>handle</code> method returns
  true (when applied to the message)&nbsp;is asked to create a new <code>Interaction</code>
  to process the message (by calling the <code>createInteraction</code> method
  inherited by every factory), and the deputy then starts the new interaction
  thread.&nbsp; If there are no registered factories, or no registered factory
  handles the information, then the deputy passes the message to a special <code>CoABSDefaultInteractionFactory</code>,
  whose <code>handle</code> method <i>always</i> returns <code>true</code>.&nbsp;
  This approach ensures that an appropriate new <code>Interaction</code> is
  created in response to every incoming message not already associated with an
  existing <code>Interaction</code>.</p>
  <p align="left">The deputy always starts factory-created interaction threads
  without waiting for them to complete, because the deputy has no
  domain-specific knowledge about what to do when they <i>do </i>complete, or
  what to do with their final results, if any.&nbsp; (This also ensures that the
  deputy is not blocked from performing its other duties while a factory-created
  interaction thread executes.)&nbsp; Consequently, if any lasting change is to
  be made to the local plan as a result of a factory-created <code>Interaction</code>,
  they must be made by one or more action methods of the <code>Interactor</code>
  used by that factory.&nbsp;</p>
</blockquote>
<hr color="#800080">
<table border="0" width="100%">
  <tr>
    <td width="33%"><font size="2"><b>Liaison Capability Tutorial</b></font></td>
    <td width="33%">
      <p align="center"><a href="administration.html"><img border="0" src="graphics/prev.gif" width="25" height="31"></a>
      <a href="index.html"><img border="0" src="graphics/home.gif" width="45" height="31"></a>
      <a href="operation.html">
      <img border="0" src="graphics/next.gif" width="21" height="31"></a></td>
    <td width="34%">
      <p align="right"><b><font size="2"><a href="../javadoc/index.html">Javadoc</a></font></b></td>
  </tr>
</table>
<p align="center"><font size="1"><a href="copyright.html">Copyright Notice</a></font></p>
<p align="left">&nbsp;</p>

</body>

</html>
